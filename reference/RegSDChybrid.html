<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Regression-based SDC Tools - Generalized microaggregation — RegSDChybrid • RegSDC</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regression-based SDC Tools - Generalized microaggregation — RegSDChybrid"><meta name="description" content="Implementation of the methodology in section 6 in the paper"><meta property="og:description" content="Implementation of the methodology in section 6 in the paper"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RegSDC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/olangsrud/RegSDC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Regression-based SDC Tools - Generalized microaggregation</h1>
      <small class="dont-index">Source: <a href="https://github.com/olangsrud/RegSDC/blob/master/R/RegSDChybrid.R" class="external-link"><code>R/RegSDChybrid.R</code></a></small>
      <div class="d-none name"><code>RegSDChybrid.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Implementation of the methodology in section 6 in the paper</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">RegSDChybrid</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  clusters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xLocal <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xGlobal <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  clusterPieces <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xClusterPieces <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  groupedClusters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xGroupedClusters <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alternative <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ySim <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  returnParts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  epsAlpha <span class="op">=</span> <span class="fl">1e-07</span>,</span>
<span>  makeunique <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  tolerance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Matrix of confidential variables</p></dd>


<dt id="arg-clusters">clusters<a class="anchor" aria-label="anchor" href="#arg-clusters"></a></dt>
<dd><p>Vector of cluster coding</p></dd>


<dt id="arg-xlocal">xLocal<a class="anchor" aria-label="anchor" href="#arg-xlocal"></a></dt>
<dd><p>Matrix of x-variables to be crossed with clusters</p></dd>


<dt id="arg-xglobal">xGlobal<a class="anchor" aria-label="anchor" href="#arg-xglobal"></a></dt>
<dd><p>Matrix of x-variables NOT to be crossed with clusters</p></dd>


<dt id="arg-clusterpieces">clusterPieces<a class="anchor" aria-label="anchor" href="#arg-clusterpieces"></a></dt>
<dd><p>Vector of coding of cluster pieces</p></dd>


<dt id="arg-xclusterpieces">xClusterPieces<a class="anchor" aria-label="anchor" href="#arg-xclusterpieces"></a></dt>
<dd><p>Matrix of x-variables to be crossed with cluster pieces</p></dd>


<dt id="arg-groupedclusters">groupedClusters<a class="anchor" aria-label="anchor" href="#arg-groupedclusters"></a></dt>
<dd><p>Vector of coding of grouped clusters</p></dd>


<dt id="arg-xgroupedclusters">xGroupedClusters<a class="anchor" aria-label="anchor" href="#arg-xgroupedclusters"></a></dt>
<dd><p>Matrix of x-variables to be crossed with grouped clusters</p></dd>


<dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>One of "" (default), "a", "b" or "c"</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Possible to specify parameter used internally by alternative "c"</p></dd>


<dt id="arg-ysim">ySim<a class="anchor" aria-label="anchor" href="#arg-ysim"></a></dt>
<dd><p>Possible to specify the internally simulated data manually</p></dd>


<dt id="arg-returnparts">returnParts<a class="anchor" aria-label="anchor" href="#arg-returnparts"></a></dt>
<dd><p>Alternative output six matrices:
y1 and y2 (fitted),    e3s and e4s (new residuals),   e3 and e4 (original residuals)</p></dd>


<dt id="arg-epsalpha">epsAlpha<a class="anchor" aria-label="anchor" href="#arg-epsalpha"></a></dt>
<dd><p>Precision constant for alpha calculation</p></dd>


<dt id="arg-makeunique">makeunique<a class="anchor" aria-label="anchor" href="#arg-makeunique"></a></dt>
<dd><p>Parameter to be used in GenQR</p></dd>


<dt id="arg-tolerance">tolerance<a class="anchor" aria-label="anchor" href="#arg-tolerance"></a></dt>
<dd><p>Parameter to <code><a href="Cdiff.html">Cdiff</a></code> used within the algorithm</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Generated version of y</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Input matrices are subjected to <code><a href="EnsureMatrix.html">EnsureMatrix</a></code>.
Necessary constant terms (intercept) are automatically included.
That is, a column of ones is not needed in the input matrices.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Øyvind Langsrud</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#################################################</span></span></span>
<span class="r-in"><span><span class="co"># Generate example data for introductory examples</span></span></span>
<span class="r-in"><span><span class="co">################################################# </span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, <span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>  <span class="co"># x &lt;- 1:10 is equivalent</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Same as RegSDCipso(y)</span></span></span>
<span class="r-in"><span><span class="va">yOut</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With a single cluster both are same as RegSDCipso(y, x)</span></span></span>
<span class="r-in"><span><span class="va">yOut</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, xLocal <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yOut</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, xGlobal <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define two clusters</span></span></span>
<span class="r-in"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MHa and MHb in paper</span></span></span>
<span class="r-in"><span><span class="va">yMHa</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusters <span class="op">=</span> <span class="va">clust</span>, xLocal <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">yMHb</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusterPieces <span class="op">=</span> <span class="va">clust</span>, xLocal <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># An extended variant of MHb as mentioned in paper paragraph below definition of MHa/MHb</span></span></span>
<span class="r-in"><span><span class="va">yMHbExt</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusterPieces <span class="op">=</span> <span class="va">clust</span>, xClusterPieces <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Identical means within clusters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>clust <span class="op">=</span> <span class="va">clust</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clust       V1       V2       V3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1 2.616377 12.40017 22.38400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     2 7.031693 18.11947 28.33711</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">yMHa</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>clust <span class="op">=</span> <span class="va">clust</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clust       V1       V2       V3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1 2.616377 12.40017 22.38400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     2 7.031693 18.11947 28.33711</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">yMHb</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>clust <span class="op">=</span> <span class="va">clust</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clust       V1       V2       V3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1 2.616377 12.40017 22.38400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     2 7.031693 18.11947 28.33711</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">yMHbExt</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>clust <span class="op">=</span> <span class="va">clust</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clust       V1       V2       V3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     1 2.616377 12.40017 22.38400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     2 7.031693 18.11947 28.33711</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Identical global regression results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y[, 1] ~ x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Min       1Q   Median       3Q      Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.99930 -0.36426 -0.24060 -0.09118  2.21208 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.6580     0.6594  -0.998    0.348    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             0.9967     0.1063   9.379 1.37e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9652 on 8 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9166,	Adjusted R-squared:  0.9062 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 87.97 on 1 and 8 DF,  p-value: 1.367e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yMHa</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yMHa[, 1] ~ x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.5952 -0.4758 -0.1294  0.4943  1.6172 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.6580     0.6594  -0.998    0.348    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             0.9967     0.1063   9.379 1.37e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9652 on 8 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9166,	Adjusted R-squared:  0.9062 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 87.97 on 1 and 8 DF,  p-value: 1.367e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yMHb</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yMHb[, 1] ~ x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.8857 -0.5874  0.2406  0.5186  1.1848 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.6580     0.6594  -0.998    0.348    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             0.9967     0.1063   9.379 1.37e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9652 on 8 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9166,	Adjusted R-squared:  0.9062 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 87.97 on 1 and 8 DF,  p-value: 1.367e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yMHbExt</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yMHbExt[, 1] ~ x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -1.1368 -0.6332 -0.4726  0.9707  1.2041 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.6580     0.6594  -0.998    0.348    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             0.9967     0.1063   9.379 1.37e-05 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9652 on 8 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9166,	Adjusted R-squared:  0.9062 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 87.97 on 1 and 8 DF,  p-value: 1.367e-05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MHa: Identical local regression results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span>, subset <span class="op">=</span> <span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = y[, 1] ~ x, subset = clust == 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1        2        3        4        5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.02312 -0.03791 -0.54574  1.29771 -0.69093 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -2.2644     0.9500  -2.384   0.0973 .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             1.6269     0.2864   5.680   0.0108 *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9058 on 3 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9149,	Adjusted R-squared:  0.8866 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 32.26 on 1 and 3 DF,  p-value: 0.01081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yMHa</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span>, subset <span class="op">=</span> <span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yMHa[, 1] ~ x, subset = clust == 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1        2        3        4        5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.61897  0.01182  1.33297 -0.22551 -0.50031 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -2.2644     0.9500  -2.384   0.0973 .</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             1.6269     0.2864   5.680   0.0108 *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.9058 on 3 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.9149,	Adjusted R-squared:  0.8866 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 32.26 on 1 and 3 DF,  p-value: 0.01081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MHb: Different results</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yMHb</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span>, subset <span class="op">=</span> <span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yMHb[, 1] ~ x, subset = clust == 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1        2        3        4        5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  0.38023 -0.06638 -0.93097  0.54016  0.07696 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -0.6187     0.6940  -0.892   0.4383  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             1.0784     0.2092   5.154   0.0142 *</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.6617 on 3 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.8985,	Adjusted R-squared:  0.8647 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 26.56 on 1 and 3 DF,  p-value: 0.01416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># MHbExt: Same estimates and different std. errors</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yMHbExt</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">~</span> <span class="va">x</span>, subset <span class="op">=</span> <span class="va">clust</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lm(formula = yMHbExt[, 1] ~ x, subset = clust == 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        1        2        3        4        5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -0.16064 -0.27625  0.69392  0.08347 -0.34050 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error t value Pr(&gt;|t|)   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  -2.2644     0.5090  -4.449  0.02113 * </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x             1.6269     0.1535  10.601  0.00179 **</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.4853 on 3 degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Multiple R-squared:  0.974,	Adjusted R-squared:  0.9653 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> F-statistic: 112.4 on 1 and 3 DF,  p-value: 0.001793</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###################################################</span></span></span>
<span class="r-in"><span><span class="co">#  Generate example data for more advanced examples</span></span></span>
<span class="r-in"><span><span class="co">###################################################</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">90</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">90</span><span class="op">)</span><span class="op">)</span>, <span class="fl">30</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">90</span><span class="op">)</span>, <span class="fl">30</span>, <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> <span class="va">x</span></span></span>
<span class="r-in"><span><span class="va">clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######## Run main algorithm</span></span></span>
<span class="r-in"><span><span class="va">z0</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusters <span class="op">=</span> <span class="va">clust</span>, xLocal <span class="op">=</span> <span class="va">x3</span>, xGlobal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Corresponding models by lm</span></span></span>
<span class="r-in"><span><span class="va">lmy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">clust</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">z0</span> <span class="op">~</span> <span class="va">clust</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Preserved regression coef (x3 within clusters)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmy</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -8.770762e-15 -3.241851e-14  1.178085e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2     -3.996803e-15 -6.661338e-16 -1.496303e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3     -4.773959e-14 -4.174439e-14 -7.949197e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           2.220446e-16  6.657001e-16 -1.220812e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           5.898060e-17  0.000000e+00 -6.834810e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3   8.847090e-17 -3.361027e-18 -4.440892e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3   8.326673e-17  7.806256e-17  8.881784e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3   2.853620e-16  3.586541e-16  5.551115e-16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Preservation of x3 coef locally can also be seen by local regression</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x3</span>, subset <span class="op">=</span> <span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">z0</span> <span class="op">~</span> <span class="va">x3</span>, subset <span class="op">=</span> <span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -1.776357e-14 -4.263256e-14 -1.079137e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x3           6.938894e-17  2.220446e-16  6.661338e-16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Covariance matrix preserved</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmy</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -1.154632e-14 -1.665335e-15  3.566591e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -1.665335e-15  1.887379e-15 -2.081668e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  3.566591e-15 -2.081668e-15  3.774758e-15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># But not preserved within clusters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmy</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lm0</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]        [,2]         [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.05283525  0.02628186  0.041320945</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.02628186  0.11017441 -0.118935218</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  0.04132094 -0.11893522 -0.007472039</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######## Modification (a)</span></span></span>
<span class="r-in"><span><span class="va">za</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusters <span class="op">=</span> <span class="va">clust</span>, xLocal <span class="op">=</span> <span class="va">x3</span>, xGlobal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>, alternative <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">za</span> <span class="op">~</span> <span class="va">clust</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Now covariance matrices preserved within clusters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmy</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lma</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  1.776357e-15 -2.053913e-15 -3.275158e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -2.053913e-15  1.132427e-14 -5.107026e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -3.275158e-15 -5.107026e-15  1.887379e-15</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If we estimate coef for x1 and x2 within clusters, </span></span></span>
<span class="r-in"><span><span class="co"># they become identical and identical to global estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lma</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     [,1]          [,2]         [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -0.853660177 -0.3350771414 -0.116021373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2     -1.502492508  1.3682670844 -0.178200192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3     -1.894139410 -0.4133242439  2.567418769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           1.037195424 -0.0038745052  0.003657673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           0.008993409  1.0099219019 -0.013992845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3   0.005125876  0.0009687508  1.011450684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3   0.008278076 -0.0124104955  1.007585746</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3   0.005526337  0.0018204153  0.986441964</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">za</span> <span class="op">~</span> <span class="va">clust</span> <span class="op">+</span> <span class="va">x1</span><span class="op">:</span><span class="va">clust</span> <span class="op">+</span> <span class="va">x2</span><span class="op">:</span><span class="va">clust</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     [,1]          [,2]         [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -0.853660177 -0.3350771414 -0.116021373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2     -1.502492508  1.3682670844 -0.178200192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3     -1.894139410 -0.4133242439  2.567418769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x1   1.037195424 -0.0038745052  0.003657673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x1   1.037195424 -0.0038745052  0.003657673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x1   1.037195424 -0.0038745052  0.003657673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x2   0.008993409  1.0099219019 -0.013992845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x2   0.008993409  1.0099219019 -0.013992845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x2   0.008993409  1.0099219019 -0.013992845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3   0.005125876  0.0009687508  1.011450684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3   0.008278076 -0.0124104955  1.007585746</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3   0.005526337  0.0018204153  0.986441964</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######## Modification (c) with automatic calculation of alpha </span></span></span>
<span class="r-in"><span><span class="co"># The result depends on the randomly generated data</span></span></span>
<span class="r-in"><span><span class="co"># When the result is that alpha=1, modification (b) is equivalent</span></span></span>
<span class="r-in"><span><span class="va">zc</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusters <span class="op">=</span> <span class="va">clust</span>, xLocal <span class="op">=</span> <span class="va">x3</span>, xGlobal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span>, alternative <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                c1: clusterAlpha =   1.880, Alpha = 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                c2: clusterAlpha =   3.065, Alpha = 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                c3: clusterAlpha =   1.321, Alpha = 1.000</span>
<span class="r-in"><span><span class="va">lmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">zc</span> <span class="op">~</span> <span class="va">clust</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Preserved regression coef as above</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmy</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                      [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -2.009504e-14 -1.576517e-14  5.676015e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2      0.000000e+00 -6.439294e-15 -1.849076e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3     -4.130030e-14 -2.686740e-14 -1.456613e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           2.220446e-16  2.662801e-16 -4.401861e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           1.543904e-16 -2.220446e-16  3.313322e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3   9.194034e-17 -3.068292e-17 -4.440892e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3   4.857226e-17  7.979728e-17  1.110223e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3   2.159731e-16  2.589075e-16  8.881784e-16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Again covariance matrices preserved within clusters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmy</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmc</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]         [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 2.109424e-15 3.885781e-16  2.942091e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 3.885781e-16 2.442491e-15  5.273559e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 2.942091e-15 5.273559e-15 -1.454392e-14</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If we estimate coef for x1 and x2 within clusters, </span></span></span>
<span class="r-in"><span><span class="co"># results are different from modification (a) above</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     [,1]          [,2]         [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) -0.853660177 -0.3350771414 -0.116021373</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2     -1.502492508  1.3682670844 -0.178200192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3     -1.894139410 -0.4133242439  2.567418769</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1           1.037195424 -0.0038745052  0.003657673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2           0.008993409  1.0099219019 -0.013992845</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3   0.005125876  0.0009687508  1.011450684</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3   0.008278076 -0.0124104955  1.007585746</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3   0.005526337  0.0018204153  0.986441964</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">zc</span> <span class="op">~</span> <span class="va">clust</span> <span class="op">+</span> <span class="va">x1</span><span class="op">:</span><span class="va">clust</span> <span class="op">+</span> <span class="va">x2</span><span class="op">:</span><span class="va">clust</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     [,1]         [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  0.148294545  0.743268966 -1.92253955</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2     -3.316413326 -0.144389429  1.16173957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3     -4.070496639 -1.673605741  8.88917470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x1   1.046242317  0.066634617 -0.02923443</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x1   1.054697315 -0.046662381  0.06809831</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x1   1.043717774 -0.004080565 -0.03469546</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x2  -0.011894602  0.982859060  0.02491830</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x2   0.016711386  1.022488986 -0.01835825</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x2   0.021789554  1.012583585 -0.05577610</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3   0.005652463 -0.001251337  1.01126158</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3   0.007517097 -0.007875766  1.00199499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3   0.005515666  0.001800353  0.98628208</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####################################################</span></span></span>
<span class="r-in"><span><span class="co"># Make groups of clusters (d) and cluster pieces (e)</span></span></span>
<span class="r-in"><span><span class="co">####################################################</span></span></span>
<span class="r-in"><span><span class="va">clustGr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"gr"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.1</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">clustP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"a"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######## Modifications (c), (d) and (e)</span></span></span>
<span class="r-in"><span><span class="va">zGrP</span> <span class="op">&lt;-</span> <span class="fu">RegSDChybrid</span><span class="op">(</span><span class="va">y</span>, clusters <span class="op">=</span> <span class="va">clust</span>, clusterPieces <span class="op">=</span> <span class="va">clustP</span>, groupedClusters <span class="op">=</span> <span class="va">clustGr</span>,</span></span>
<span class="r-in"><span>                     xLocal <span class="op">=</span> <span class="va">x3</span>, xGroupedClusters <span class="op">=</span> <span class="va">x2</span>, xGlobal <span class="op">=</span> <span class="va">x1</span>, alternative <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                c1: clusterAlpha =   2.087, Alpha = 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                c2: clusterAlpha =   1.304, Alpha = 1.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                c3: clusterAlpha =   1.662, Alpha = 1.000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Corresponding models by lm</span></span></span>
<span class="r-in"><span><span class="va">lmGrP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">zGrP</span> <span class="op">~</span> <span class="va">clust</span><span class="op">:</span><span class="va">clustP</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">:</span><span class="va">clustGr</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lmY</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">clust</span><span class="op">:</span><span class="va">clustP</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span><span class="op">:</span><span class="va">clustGr</span> <span class="op">+</span> <span class="va">x3</span><span class="op">:</span><span class="va">clust</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Preserved regression coef</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmY</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">lmGrP</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                          [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x1               2.220446e-16 -3.382711e-16  7.285839e-17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:clustPa -2.886580e-15 -3.587061e-14  1.087463e-13</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:clustPa            NA            NA            NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:clustPa            NA            NA            NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:clustPb -3.108624e-15  2.636780e-14  3.907985e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:clustPb  2.220446e-16 -8.881784e-16 -6.328271e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:clustPb -1.953993e-14 -2.120526e-14  3.086420e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2:clustGrgr1    1.006140e-16  8.881784e-16  7.060325e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x2:clustGrgr2   -8.066464e-17 -2.220446e-16 -7.025630e-17</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc1:x3       2.255141e-17 -4.386682e-16 -4.440892e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc2:x3       6.158268e-17  7.979728e-17  2.220446e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> clustc3:x3       2.029626e-16  3.061787e-16 -1.110223e-16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Identical means within cluster pieces</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>clust <span class="op">=</span> <span class="va">clust</span>, clustP <span class="op">=</span> <span class="va">clustP</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clust clustP        V1       V2        V3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    c1      a  2.875937 45.57646  98.07293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    c1      b 11.414383 57.33851 113.35811</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    c2      b 22.222100 66.88903 119.61147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    c3      b 38.492482 72.32188 124.98224</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">zGrP</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>clust <span class="op">=</span> <span class="va">clust</span>, clustP <span class="op">=</span> <span class="va">clustP</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   clust clustP        V1       V2        V3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    c1      a  2.875937 45.57646  98.07293</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    c1      b 11.414383 57.33851 113.35811</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    c2      b 22.222100 66.88903 119.61147</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    c3      b 38.492482 72.32188 124.98224</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Covariance matrix preserved</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmY</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmGrP</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -5.884182e-15 -1.179612e-15 -2.248202e-15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -1.179612e-15  3.552714e-15  1.053324e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -2.248202e-15  1.053324e-14  1.687539e-14</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Covariance matrices preserved within clusters</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmY</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmGrP</span><span class="op">)</span><span class="op">[</span><span class="va">clust</span> <span class="op">==</span> <span class="st">"c2"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               [,1]          [,2]          [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  5.440093e-15 -7.938095e-15 -8.326673e-16</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -7.938095e-15  3.330669e-15  2.103873e-14</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -8.326673e-16  2.103873e-14  2.220446e-16</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Covariance matrices not preserved within cluster pieces</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmY</span><span class="op">)</span><span class="op">[</span><span class="va">clustP</span> <span class="op">==</span> <span class="st">"a"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">lmGrP</span><span class="op">)</span><span class="op">[</span><span class="va">clustP</span> <span class="op">==</span> <span class="st">"a"</span>, <span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]         [,2]        [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -0.04089730  0.056294035 -0.08208031</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.05629403 -0.004892891  0.01946627</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -0.08208031  0.019466271 -0.04426915</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Øyvind Langsrud.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

